<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self';
                   script-src 'self' https://unpkg.com https://cdn.jsdelivr.net;
                   style-src 'self' https://unpkg.com 'unsafe-inline';
                   img-src 'self' https: data:;
                   connect-src 'self' https://server.arcgisonline.com https://scholar.google.com;
                   frame-ancestors 'none'">
    <title>Lunar Regolith Simulant Database</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha384-sHL9NAb7lN7rfvG5lfHpm643Xkcjzp4jFvuavGOndn6pjVqS6ny56CAt3nsEVT4H"
          crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
          integrity="sha384-pmjIAcz2bAn0xukfxADbZIb3t8oRT9Sv0rvO+BR5Csr6Dhqq+nZs59P0pPKQJkEV"
          crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
          integrity="sha384-wgw+aLYNQ7dlhK47ZPK7FRACiq7ROZwgFNg0m04avm4CaXS+Z9Y7nMu8yNjBKYC+"
          crossorigin="anonymous" />
</head>

<body>
    <!-- Filters Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div>
                <h2>Lunar Regolith Simulants</h2>
                <p class="subtitle">Interactive Database <span class="version-tag">v1.6.1</span></p>
            </div>
            <button id="close-sidebar" class="btn-close-sidebar" title="Close menu">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="filters-section">
            <div class="filter-group">
                <label title="Search for a specific simulant">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    Quick Select Simulant
                </label>
                <select id="lrs-dropdown" class="select-modern" title="Select a simulant to view details">
                    <option value="">Search or select...</option>
                </select>
                <button id="clear-filters" class="btn-clear-filters" title="Reset all filters and return to home view">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                        </path>
                    </svg>
                    Clear All Filters
                </button>
            </div>

            <div class="filter-divider"></div>

            <div class="filter-group">
                <label title="Filter by simulant type">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h18v18H3zM3 9h18M9 21V9"></path>
                    </svg>
                    Type
                </label>
                <div class="select-all-wrapper">
                    <button class="select-all-btn" data-target="type-filter" data-action="select" title="Select all types">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        All
                    </button>
                    <button class="deselect-all-btn" data-target="type-filter" data-action="deselect" title="Deselect all types">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        None
                    </button>
                </div>
                <select id="type-filter" multiple class="select-modern" title="Click to toggle selection">
                </select>
            </div>

            <div class="filter-group">
                <label title="Filter by country of origin">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M2 12h20"></path>
                        <path
                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                        </path>
                    </svg>
                    Country
                </label>
                <div class="select-all-wrapper">
                    <button class="select-all-btn" data-target="country-filter" data-action="select" title="Select all countries">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        All
                    </button>
                    <button class="deselect-all-btn" data-target="country-filter" data-action="deselect" title="Deselect all countries">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        None
                    </button>
                </div>
                <select id="country-filter" multiple class="select-modern" title="Click to toggle selection">
                </select>
            </div>

            <div class="filter-group">
                <label title="Filter by mineral composition">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                    Mineral
                </label>
                <div class="select-all-wrapper">
                    <button class="select-all-btn" data-target="mineral-filter" data-action="select" title="Select all minerals">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        All
                    </button>
                    <button class="deselect-all-btn" data-target="mineral-filter" data-action="deselect" title="Deselect all minerals">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        None
                    </button>
                </div>
                <select id="mineral-filter" multiple class="select-modern" title="Click to toggle selection">
                </select>
            </div>

            <div class="filter-group">
                <label title="Filter by chemical composition">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6m0 6v6"></path>
                        <path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24"></path>
                        <path d="M1 12h6m6 0h6"></path>
                        <path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24"></path>
                    </svg>
                    Chemical
                </label>
                <div class="select-all-wrapper">
                    <button class="select-all-btn" data-target="chemical-filter" data-action="select" title="Select all chemicals">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        All
                    </button>
                    <button class="deselect-all-btn" data-target="chemical-filter" data-action="deselect" title="Deselect all chemicals">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        None
                    </button>
                </div>
                <select id="chemical-filter" multiple class="select-modern" title="Click to toggle selection">
                </select>
            </div>

            <div class="filter-group">
                <label title="Filter by institution">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 21h18M9 8h1M9 12h1M9 16h1M14 8h1M14 12h1M14 16h1M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"></path>
                    </svg>
                    Institution
                </label>
                <div class="select-all-wrapper">
                    <button class="select-all-btn" data-target="institution-filter" data-action="select" title="Select all institutions">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        All
                    </button>
                    <button class="deselect-all-btn" data-target="institution-filter" data-action="deselect" title="Deselect all institutions">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        None
                    </button>
                </div>
                <select id="institution-filter" multiple class="select-modern" title="Click to toggle selection">
                </select>
            </div>
        </div>

        <div class="sidebar-footer">
            <p>Click on a marker to view details</p>
            <p class="data-count" id="simulant-count">Loading data...</p>
            <div class="export-section">
                <button id="export-btn" class="btn-export" title="Export simulant data">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Export Data
                </button>
                <div id="export-dropdown" class="export-dropdown">
                    <button class="export-option" data-export="current" title="Export currently selected simulant">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        Current Simulant
                    </button>
                    <button class="export-option" data-export="filtered" title="Export all simulants matching current filters">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                        </svg>
                        Filtered Results
                    </button>
                    <button class="export-option" data-export="all" title="Export all simulants in the database">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="9" y1="21" x2="9" y2="9"></line>
                        </svg>
                        All Simulants
                    </button>
                </div>
            </div>
            <a href="https://cnes.fr" target="_blank" rel="noopener" class="sponsor-badge">
                <span>Sponsored by</span>
                <img src="assets/cnes-logo.png" alt="CNES">
            </a>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay"></div>

    <!-- Map Container -->
    <div id="map-container">
        <!-- Mobile Menu Button -->
        <button id="menu-toggle" class="map-btn menu-toggle" title="Open filters menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <button id="home-button" class="map-btn" title="Reset map view to default position">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        </button>

        <div id="map"></div>
    </div>

    <!-- Country List Panel -->
    <div id="country-panel" class="country-panel">
        <div class="country-panel-header">
            <h3 id="country-panel-title">Simulants by Country</h3>
            <button class="btn-icon" id="close-country-panel" title="Close country panel">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="country-panel-content" id="country-panel-content">
            <p class="placeholder-text">Select a country to view simulants</p>
        </div>
    </div>

    <!-- Info Panel 1 -->
    <div id="info-panel-1" class="info-panel">
        <div class="panel-handle" data-panel="1" title="Click to minimize/maximize panel">
            <div class="handle-bar"></div>
        </div>

        <div class="panel-header">
            <h3 class="panel-title">Select a simulant</h3>
            <div class="panel-actions">
                <button class="btn-search-sources" id="search-sources-1" title="Search Google Scholar for papers about this simulant">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    Sources
                </button>
                <button class="btn-download-simulant" id="download-btn-1" title="Download this simulant's data as CSV">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download
                </button>
                <button class="btn-icon compare-btn-panel" id="compare-btn-1" title="Compare with another simulant">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                </button>
                <button class="btn-icon" id="pin-panel-1" title="Pin panel to keep it open">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 4v6l-2 4v2h10v-2l-2-4V4"></path>
                        <line x1="12" y1="16" x2="12" y2="21"></line>
                        <line x1="8" y1="4" x2="16" y2="4"></line>
                    </svg>
                </button>
                <button class="btn-icon close-panel" data-panel="1" title="Close panel">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>

        <div class="panel-content">
            <div class="info-card properties-card">
                <h4>Properties</h4>
                <div id="properties-panel-1" class="properties-content">
                    <p class="placeholder-text">Select a simulant to view properties</p>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <h4>Mineral Composition</h4>
                    <div class="chart-wrapper">
                        <canvas id="mineral-chart-1"></canvas>
                    </div>
                </div>

                <div class="info-card">
                    <h4>Chemical Composition</h4>
                    <div class="chart-wrapper">
                        <canvas id="chemical-chart-1"></canvas>
                    </div>
                </div>
            </div>

            <div class="info-card references-card">
                <h4>References</h4>
                <div id="references-panel-1" class="references-content">
                    <div class="references-section">
                        <h5 class="reference-section-title">Composition Source</h5>
                        <div id="composition-refs-1" class="composition-refs">
                            <p class="placeholder-text">Select a simulant to view references</p>
                        </div>
                    </div>
                    <div class="references-section">
                        <h5 class="reference-section-title">Usage Studies</h5>
                        <div id="usage-refs-1" class="usage-refs">
                            <p class="placeholder-text"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Panel 2 (for comparison) -->
    <div id="info-panel-2" class="info-panel comparison-panel">
        <div class="panel-handle" data-panel="2" title="Click to minimize/maximize panel">
            <div class="handle-bar"></div>
        </div>

        <div class="panel-header">
            <h3 class="panel-title">Select second simulant</h3>
            <div class="panel-actions">
                <button class="btn-search-sources" id="search-sources-2" title="Search Google Scholar for papers about this simulant">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    Sources
                </button>
                <button class="btn-download-simulant" id="download-btn-2" title="Download this simulant's data as CSV">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download
                </button>
                <button class="btn-icon" id="pin-panel-2" title="Pin panel to keep it open">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 4v6l-2 4v2h10v-2l-2-4V4"></path>
                        <line x1="12" y1="16" x2="12" y2="21"></line>
                        <line x1="8" y1="4" x2="16" y2="4"></line>
                    </svg>
                </button>
                <button class="btn-icon close-panel" data-panel="2" title="Close this comparison panel">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>

        <div class="panel-content">
            <div class="info-card properties-card">
                <h4>Properties</h4>
                <div id="properties-panel-2" class="properties-content">
                    <p class="placeholder-text">Select a simulant to compare</p>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <h4>Mineral Composition</h4>
                    <div class="chart-wrapper">
                        <canvas id="mineral-chart-2"></canvas>
                    </div>
                </div>

                <div class="info-card">
                    <h4>Chemical Composition</h4>
                    <div class="chart-wrapper">
                        <canvas id="chemical-chart-2"></canvas>
                    </div>
                </div>
            </div>

            <div class="info-card references-card">
                <h4>References</h4>
                <div id="references-panel-2" class="references-content">
                    <div class="references-section">
                        <h5 class="reference-section-title">Composition Source</h5>
                        <div id="composition-refs-2" class="composition-refs">
                            <p class="placeholder-text">Select a simulant to compare</p>
                        </div>
                    </div>
                    <div class="references-section">
                        <h5 class="reference-section-title">Usage Studies</h5>
                        <div id="usage-refs-2" class="usage-refs">
                            <p class="placeholder-text"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha384-cxOPjt7s7Iz04uaHJceBmS+qpjv2JkIHNVcuOrM+YHwZOmJGBXI00mdUXEq65HTH"
            crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"
            integrity="sha384-eXVCORTRlv4FUUgS/xmOyr66XBVraen8ATNLMESp92FKXLAMiKkerixTiBvXriZr"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"
            integrity="sha384-FcQlsUOd0TJjROrBxhJdUhXTUgNJQxTMcxZe6nHbaEfFL1zjQ+bq/uRoBQxb0KMo"
            crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>

</html>